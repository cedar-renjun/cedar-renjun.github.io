<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Enjoy Programming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Enjoy Programming">
<meta property="og:url" content="http://cedar-renjun.github.io/index.html">
<meta property="og:site_name" content="Enjoy Programming">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Enjoy Programming">
<meta name="twitter:description">
  
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Enjoy Programming</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Focus On Embedded System</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/plan">Plan</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://cedar-renjun.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Setup-STM32F7-develop-environment" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/08/Setup-STM32F7-develop-environment/" class="article-date">
  <time datetime="2015-10-07T17:25:59.000Z" itemprop="datePublished">Oct 8 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/STM32F7/">STM32F7</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/08/Setup-STM32F7-develop-environment/">建立STM32 F7 MDK 开发环境</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="安装MDK5开发环境">安装MDK5开发环境</h3><ol>
<li>下载最新版<a href="http://www2.keil.com/mdk5/" target="_blank" rel="external">]MDK5</a></li>
<li>利用<a href="http://cedar-renjun.github.io/assets/2015/10/8/Keil_ARM_MDK_5.00_Keygen_serial_Crack.exe.zip">工具</a> 破解MDK5</li>
</ol>
<p>以上两步比较简单，不详描述</p>
<h3 id="安装CubeF7">安装CubeF7</h3><p>CubeMX是ST提供的一套库和框架标准，也是一种工程模版</p>
<ol>
<li>下载<a href="http://www.st.com/web/en/catalog/tools/PF261909" target="_blank" rel="external">http://www.st.com/web/en/catalog/tools/PF261909</a></li>
<li>下载完成后，利用MDK5打开STM32Cube_FW_F7_V1.1.0\Projects\STM32746G-Discovery\Demonstration\MDK-ARM\Project.uvprojx</li>
</ol>
<h3 id="更新ST-Link驱动和固件">更新ST-Link驱动和固件</h3><ol>
<li>进入ST官网<a href="http://www.st.com/web/catalog/tools/FM146/CL1984/SC720/SS1450/PF251168?s_searchtype=partnumber" target="_blank" rel="external">http://www.st.com/web/catalog/tools/FM146/CL1984/SC720/SS1450/PF251168?s_searchtype=partnumber</a></li>
<li>通过<a href="http://www.st.com/web/en/catalog/tools/PF260219" target="_blank" rel="external">STSW-LINK009</a>更新st-link驱动</li>
<li>通过<a href="http://www.st.com/web/en/catalog/tools/PF258194" target="_blank" rel="external">STSW-LINK005</a>来更新固件</li>
</ol>
<h3 id="连接F7_Discovery开发板">连接F7 Discovery开发板</h3><ol>
<li>将<code>JP1</code>的跳帽安装到<code>5V-link</code></li>
<li>找一根mini USB线，插入<code>CN14</code></li>
<li>插入电脑USB口，这时系统会枚举出ST-link设备，然后F7会启动固件，在屏幕上显示图标</li>
</ol>
<h3 id="常见问题">常见问题</h3><ol>
<li>插入USB后，屏幕没亮；将USB插入充电器口，屏幕不亮</li>
</ol>
<p>因为默认通过ST-link来供电，插入电脑USB接口后，只有枚举成功后，才会开启MCU的供电系统<br>枚举的时候，100mA；枚举成功后，才能供电500mA，如果电脑USB不接受500mA或者使用USB，就会枚举失败<br>详细的信息，请参考<a href="http://www.st.com/st-web-ui/static/active/en/resource/technical/document/user_manual/DM00190424.pdf" target="_blank" rel="external">手册Power章节</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STM32F746G-DISCO discovery board can be powered from ST-LINK USB connector CN14 (5V link), but only ST-LINK circuit has&#10;the power before USB enumeration, because the host PC only provides 100mA to the board at that time. During the USB&#10;enumeration, STM32F746G-DISCO board asks for the 500mA power to the host PC. If the host is able to provide the required&#10;power, the enumeration finishes by a &#8220;SetConfiguration&#8221; command and then, the power transistor U8 (ST890) is switched&#10;ON, the red LED LD2 is turned ON, thus STM32F746G-DISCO board can consume maximum 500mA current, but no more. If the&#10;host is not able to provide the requested current, the enumeration fails. Therefore the ST890 (U8) remains OFF and the&#10;MCU part including the extension board won&#8217;t be powered. As a consequence the red LED LD2 remains turned OFF. In this&#10;case it is mandatory to use an external power supply.</span><br></pre></td></tr></table></figure>
<ol>
<li>用MDK5编译工程后，下载到板子，图标显示不正常</li>
</ol>
<p>MDK的download工具，默认没有支持外部Flash的算法，所以会导致没有图标的部分，没有烧录到FLASH芯片</p>
<p>解决方案</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Open STM32 ST-Link Utility V3.<span class="number">6</span>, click on "External Loader" from the bar menu then check "N25Q128A_STM32F746G-DISCO" box </span><br><span class="line">- Connect the STM32746G-DISCOVERY board to PC with USB cable through CN14</span><br><span class="line">- Use "STM32CubeDemo_STM32746G-DISCO_V1.<span class="number">0</span>.<span class="number">1</span>.hex" file with STM32 ST-Link Utility to program both internal Flash and external QSPI memory</span><br><span class="line">- Run the demonstration</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/08/Setup-STM32F7-develop-environment/" data-id="cifh3uno9003xwsxn83ca8to5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Networking-and-the-BSD-Sockets-APIs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/07/Networking-and-the-BSD-Sockets-APIs/" class="article-date">
  <time datetime="2015-10-07T03:56:59.000Z" itemprop="datePublished">Oct 7 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/socket/">socket</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/07/Networking-and-the-BSD-Sockets-APIs/">Networking and the BSD Sockets APIs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>by Michael Beam<br>12/27/2002</p>
<p>原文链接: <a href="http://www.macdevcenter.com/pub/a/mac/2002/12/26/cocoa.html?page=1" target="_blank" rel="external">http://www.macdevcenter.com/pub/a/mac/2002/12/26/cocoa.html?page=1</a></p>
<p>We’ve spend a great deal of time talking about Rendezvous in the previous two columns, but Rendezvous can’t exist in a vacuum. Having user-friendly service discovery does us no good unless we can make our applications talk to one another. Indeed, Rendezvous has absolutely no provisions for facilitating general network communications between applications, as it is only a protocol for advertising and discovering services on a network. It is a discovery protocol, not a communications protocol.</p>
<p>Today we shift gears into the communications side of this business; we will have very little to say about Rendezvous. Due to its Unix lineage, Mac OS X is a wonderful platform for learning about networking, since it has such a rich set of APIs to offer; in particular, we can program with the venerable BSD sockets API. Today we’ll learn about this API, and in doing so we will write a tiny pair of C applications that demonstrate how clients and servers can be made to talk with one another. In the next column, we will finish RCE with what we learn today by adding some Cocoa.</p>
<h4 id="Concerning_Sockets">Concerning Sockets</h4><p>Most of us have likely heard of sockets in the course of our experiences programming. I had always heard about sockets, but up until about half a year ago, I had never had the pleasure of programming with them. Having heard of something is far from understanding it, which is essential to being able to effectively use a technology. In this column and the next, I hope to spark some interest in the subject to give you a feel for the technology. Hopefully, many of you who had previously shied away from sockets and networking will go on to learn more about this interesting and relevant topic.</p>
<p>So just what is a socket? The man page for the socket() function, which we use to create sockets, describes this little thing in four words: an endpoint for communication. The analogy often used to relate sockets to everyday experiences is that of a telephone, which, as we will see, is indeed an accurate comparison. A telephone is, after all, an endpoint, or an interface, to a communications network that we use to communicate with other people.</p>
<p>In the same way that we speak into and listen to a phone, applications both send data across a network by writing to a socket, and receive data sent by a remote host by reading from the socket. If you are familiar with the Unix APIs for reading and writing to a file, you will be comfortable with sockets, as the same functions for file I/O are used for socket I/O – namely, read() and write().</p>
<p>Like two telephones that facilitate a conversation between two people, network connections exist between a pair of sockets, one for each end of the connection. Sockets are often talked about in pairs: one for the server side of the application, and one for the client side. The networking model that we are accustomed to is that of the relationship between a client and a server. A server is an application that is listening for connection requests from clients, and handling them appropriately. A client is a program that connects to a server. Usually client and servers are two completely different applications, as is the case with a Web client and server: Apache is a Web server, while OmniWeb, Internet Explorer, and Mozilla are all Web clients.</p>
<p>We will see in the next column how this distinction between server and client blurs when we talk about peer-to-peer chat applications like RCE. Sometimes, one application is both a client and a server that allows connections from other like applications. This is especially true of peer-to-peer applications, such as the chat application we’re building. We’ll get into this more in the next column, but understand as we progress through our discussion today that RCE will have both server functionality and client functionality.</p>
<h4 id="Working_With_Sockets">Working With Sockets</h4><p>Because of the differing tasks of a server and a client, their use of sockets is accordingly different. The role each side takes in establishing a communications link is reflected in the nature of the sockets each side uses. To wit, servers use what are known as passive sockets, and clients use active sockets.</p>
<p>When a server process starts up, it must create a socket; bind it to a local, unused port; tell that socket to listen for new connections from clients; and finally, begin waiting for new connections. This socket is often referred to as a listening socket, or a passive socket, or a server socket. All of these names suggest that the role of the socket is to sit patiently while listening to its assigned port for clients requesting a connection with the server. In the analogy of the telephone, creating the socket is like buying a phone, binding is akin to getting a hookup from the phone company, listening is plugging your phone into the wall, and finally, accepting is the act of answering the phone when it rings.</p>
<p>When a connection is received by the listening socket, the server must accept the connection and return a new connected socket that is used to communicate with the client. This new socket has an established connection to the client’s remote socket. By creating a new socket to handle the new connection, the listening socket is free to continue doing its thing, listening for connections from other clients.</p>
<p>Clients use sockets in a different way. A client creates a socket in the same way as a server; however, after the socket is created the use of the socket differs. With a socket in hand, the client uses that socket to attempt to connect to a server. Once the connection has been accepted by the server, the client can begin sending and receiving data from the server. Referring back to our phone analogy, connecting is no different than dialing a phone number for someone you want to talk to.</p>
<h4 id="Our_Sockets_Toolkit">Our Sockets Toolkit</h4><p>What are all of these functions that we have been alluding to without mentioning? They are the functions of the BSD Sockets API, which is primarily defined in the header sys/socket.h (header file paths are always referenced relative to the path /usr/include). There are seven functions that we will discuss, three of which are part of the standard library. They are:</p>
<ul>
<li><p><code>int socket( int domain, int type, int protocol )</code><br>Creates a new socket and returns the socket file descriptor. The domain argument is a constant to specify the address family of the socket; we will use AF_INET, which is IPv4 addressing. The argument type specifies the socket type; we will pass the constant SOCK_STREAM here, which is a TCP stream socket. The protocol argument does not concern us here, so we pass 0. Returns -1 if there is an error.</p>
</li>
<li><p><code>int connect( int s, const struct sockaddr *name, int namelen )</code><br>Connects the socket identified by the file descriptor s to the remote socket specified in the address structure name. Returns 0 on success, -1 on error.<br>int bind(  int s, const struct sockaddr *name, int namelen )<br>Binds the socket s to the port specified in the address structure name. Returns 0 on success, -1 on error.</p>
</li>
<li><p><code>int listen( int s, int backlog )</code><br>Converts the socket s into a passive listening (server) socket. The parameter backlog specifies how many pending connections the kernel will allow before clients who attempt to connect will receive a connection refused error. Returns 0 on success, -1 on error.</p>
</li>
<li><p><code>int accept( int s, struct sockaddr *addr, int *addrlen )</code><br>This function will return a socket connected to the remote socket with the first connection request in the connection queue. The socket returned is not the same socket as s, but it has the same properties as s. The address structure of the connected socket is returned in the struct addr. Returns -1 if there is an error.<br>ssize_t read( int d, void *buf, size_t nbytes )<br>Attempts to read nbytes of data from the socket d into the array buf. Returns the number of bytes that was actually read.</p>
</li>
<li><p><code>ssize_t write( int d, const void *buf, size_t nbytes )</code><br>This function writes to the socket d nbytes number of bytes from the array buf.</p>
</li>
<li><p><code>int close(  int s )</code><br>This function closes the socket.</p>
</li>
</ul>
<p>Let’s take a moment to look at these functions. We discussed above that servers and clients use sockets in different ways. As such, some of these functions are only appropriate for use by a client and others are used only by servers. First, both clients and servers use socket(), read(), write(), and close(). The function connect() is used by clients, while the remaining three – bind(), listen(), and accept() – are used by servers.</p>
<h4 id="Our_Program_for_the_Day">Our Program for the Day</h4><p>Today we’ll create two small C applications. We won’t be learning any new Cocoa today. To code a C application, you have two options. In the first, you can create a new project in Project Builder for the client application, and another project for the server application. The type of project you need to make is a Standard Tool, which is the last item in the New Project Assistant’s list of project types. When you create a new standard tool project, you will be presented with a single file in the Sources group: main.c. This file has some code in it that does the whole “Hello, World!” bit – we can replace all of this with our own code (even the main function and #include statements). If you do the code here today, remember that you have to create a project for both the client and the server code, since we need two executables.</p>
<p>The other alternative is to do this all from Terminal, which is what I did when I wrote the code for this column. Here we only have to work with two files, server.c and client.c, and the cc command. When we get to the relevant parts, I’ll show how to compile the code from both the Unix shell and from Project Builder. In each section where I present client and server code, I will go through the steps we have to code in a somewhat isolated manner, and at the end present the entire source code for the component (client or server).</p>
<p>So, with that, onward!</p>
<h4 id="Clients">Clients</h4><p>Clients use sockets in the following manner: first, a client application must create a socket, which is done using the socket() function, as shown here:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int sockfd</span><br><span class="line"></span><br><span class="line">if ( (sockfd = socket( AF_INET, SOCK_STREAM, 0 )) &lt; 0 ) &#123;</span><br><span class="line">   perror( "socket" );</span><br><span class="line">   exit(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>This will create a TCP/IP streaming socket. A TCP streaming socket is a very reliable means of communication with all sorts of error checking built into the TCP protocol, and a convenient, two-way, byte based interface to communicating. The socket() function takes three arguments: the domain, the type, and the protocol. With the domain parameter we indicate the communications domain of the socket, which is based on a particular address family. The constant AF_INET that we use here tells the socket() function that we will be working with IPv4 addresses. The second argument, the type, specifies the type of socket we want. SOCK_STREAM indicates that we want a TCP streaming socket. Other types include datagram and raw sockets. Finally, we have the protocol argument. This argument isn’t used much, since each combination of domain and type usually supports only one protocol. So, we pass 0, and leave it at that.</p>
<p>Note how we handle an error in the socket() function. If a call to socket() is successful, it will return the file descriptor for the new socket, which is a small, positive integer. However, if the call to socket() resulted in an error, -1 is returned. We can check to see if the value of sockfd is positive or negative in an if-statement, as shown above. If there is an error, we handle it by printing the error message with a call to perror(), and we exit with a status of 1 (1 indicates to the parent process, usually a shell such as tcsh, that there was an error in the program. For more information on perror(), see the perror man page by typing man perror in the Terminal).</p>
<p>With a socket in hand, we call the connect() function, which will attempt to make a connection between the specified socket and a socket listening on a remote host. In the list of functions above, we saw that the connect() function’s second argument is type struct sockaddr, which is also used in the bind() and accept() functions. Interestingly, we never work with a sockaddr struct. Rather, sockaddr is kind of like an abstract superclass for protocol and address family-specific socket address structures. In other words, we never work with an actual sockaddr structure, but rather with an address structure for IPv4 or IPV6 addresses.</p>
<p>For IPv4, the address structure we use is of type struct sockaddr_in. The primary reason for the existence of the generic socket address structure type is that when the socket APIs were first written, ANSI C hadn’t settled on void * as the generic pointer type. However, sockets had to support multiple address families, and the idea of having a separate set of socket functions for each domain was unappealing to the API developers. To get around this, the writers of the sockets API had to come up with their own generic pointer type specifically for socket address structures: struct sockaddr. That bit of history aside, the definition for struct sockaddr_in is found in the header netinet/in.h (when we are using the sockets API with IPv4, we have to include this header in addition to sys/sockets.h). The definition for struct sockaddr_in is as follows:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> sockaddr_in &#123;</span><br><span class="line">   u_char  sin_len;</span><br><span class="line">   u_char  sin_family;</span><br><span class="line">   u_short sin_port;</span><br><span class="line">   <span class="keyword">struct</span>  in_addr sin_addr;</span><br><span class="line">   <span class="keyword">char</span>    sin_zero[<span class="number">8</span>];     </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>The first member of the structure, u_char sin_len, is the length in bytes of the structure. The data type u_char is a synonym for unsigned char; the type definitions for that and other commonly-used types can be found in the header sys/types.h. Except for special uses of sockets, we don’t need to set or examine the value of the sin_len member; it is used internally by the kernel in various socket routines. The second member of sockaddr_in is sin_family, which is the address family of the socket. This member is set to the same constant that we passed as the protocol argument of the socket() function (AF_INET, for example). The next member, sin_port, is the port number to which we wish to connect. Our next member, sin_addr, is itself a structure of type struct in_addr. Next we have another struct, in_addr. This structure looks like this (and you’ll probably think this is dumb):<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> in_addr &#123;</span><br><span class="line">   <span class="keyword">in_addr_t</span> s_addr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>The sole member of this structure, s_addr, is type in_addr_t. The definition for this type is again found in sys/types.h, in which we find that in_addr_t is a 32-bit unsigned integer, which is a usually an unsigned int. When initializing our socket address structure, this is where we put the IP address to which we are either binding or attempting to connect. Finally, getting back up to sockaddr_in, the last member is just an array that pads the structure to a certain size. All we have to do is make sure that it is initialized to 0.</p>
<p>Now that we know what all is contained in a socket address structure, we can move on with our client code to connect to a server host. Before we can use the connect() function, we have to prepare an address structure so that the function knows where to connect. Socket address structures are prepared by first zeroing the memory that stores the structure, and then we go on to fill in the relevant fields, as shown here:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bzero( &amp;serverAddress, <span class="keyword">sizeof</span>(serverAddress) );</span><br><span class="line">serverAddress.sin_family = AF_INET;</span><br><span class="line">serverAddress.sin_port = htons( <span class="number">12345</span> );</span><br><span class="line">inet_pton( AF_INET, <span class="string">"127.0.0.1"</span>, &amp;serverAddress.sin_addr );</span><br></pre></td></tr></table></figure></p>
<p>There are several things to take note of here. The first thing we do is initialize the entire structure to 0 using the bzero() function, which stands for byte zero. This function takes the starting address of a chunk of memory that we want to zero, and the number of bytes to zero. In our case we pass the address of the variable serverAddress, obtained using the address operator &amp;, and we pass the result of the sizeof() macro with serverAddress as the parameter (sizeof is used quite frequently in C to determine at runtime the size in bytes of a variable or data type).</p>
<p>Next we set sin_family to AF_INET: the same address family we created our socket with. Next we set the port number in sin_port to 12345. When we get to the server side of all of this, we will see that 12345 is the port number that we will bind our listening socket to.</p>
<p>Note the use of the function htons(). This function stands for host to network short, and it is used to convert a short int from the host byte (little- or big-endian) order to the network byte order (big-endian). If you haven’t been introduced to issues of byte order, then here is a quick rundown. Let’s continue with the example of a short int: a short int is 16 bits in size, or 2 bytes. Different computer architectures store and read the value of a multi-byte data type in memory differently. If you’re scanning through memory and come across the two bytes of a short int variable, will you come across either the low-order byte (little end) or the high-order byte (big end), first. In little-endian systems, you will run across the little end first, while in big-endian systems you run across the big end first.</p>
<p>The use of htons() and other similar functions is necessary because not all platforms order bytes within a multi-byte data type (such as short int, 2 bytes) the same way. We will see later another variant of this function, htonl() – host to network long.</p>
<p>Lastly, we set the address to which we want to connect. For the purposes of this column, we will connect our socket to the server socket bound to port 12345 on localhost, which has an IP address of 127.0.0.1. The function inet_pton() is a convenient function for converting a string into an in_addr structure. The name of the function is short for Internet Presentation to Number. Presentation refers to the human-readable representation of an IP address, while Number refers to the integer representation of an IP address required by the in_addr struct. By specifying AF_INET in the first argument, we are telling the function that we are working with IPv4 addresses.</p>
<p>Now, let’s connect. To connect to a remote socket we do the following:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( connect( sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;serverAddress, </span><br><span class="line">               <span class="keyword">sizeof</span>(serverAddress)) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">   perror( <span class="string">"connect"</span> );</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>If connect() returns successfully, then we can begin communicating with the server. In our simple client example, we will do nothing more than read a short message sent by the server when a connection is received, which is done using the read() function:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declared up above</span></span><br><span class="line"><span class="keyword">char</span> buffer[<span class="number">201</span>];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ( (n = read( sockfd, buffer, <span class="number">200</span> )) &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">   buffer[n] = <span class="number">0</span>;	<span class="comment">// Terminate string with null character</span></span><br><span class="line">   <span class="built_in">printf</span>( buffer );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( n &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">   perror( <span class="string">"read"</span> );</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Due to the relatively slow nature of network connections, a client application is not guaranteed to receive the full message sent by the server in the time between calling connect() and the first read() call. Thus, we stick read() in a while loop and check the return value of read() at each pass to see how many bytes were read, and continue reading bytes until there are no more to be read (more data will be received in the time between subsequent calls to read()). Within the loop, we set the nth character of the buffer to the null character, and print out the string we have so far. The array buffer was made 201 bytes large to make room for the null character if the read function did indeed happen to get 200 bytes in one pass. Since we set the next character after the last one read to null, printf() will only print those characters received in the last call to read(). Functions that work with character arrays as strings always look for a null character to signal the end of the string, so that they don’t attempt to access memory that is not theirs to access.</p>
<p>So let’s take a look at our simple client program in its entirety, and then we’ll get on to discuss how to make a super-simple server for our client. Here is client.c:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#60;sys/types.h&#62;&#10;#include &#60;sys/socket.h&#62;&#10;#include &#60;netinet/in.h&#62;&#10;&#10;int main( int argc, char **argv )&#10;&#123;&#10;   int n, sockfd;&#10;   char buffer[201];&#10;   struct sockaddr_in serverAddress;&#10;&#10;   if ( (sockfd = socket( AF_INET, SOCK_STREAM, 0 )) &#60; 0 ) &#123;&#10;      perror( &#34;socket&#34; );&#10;      exit(1);&#10;   &#125; &#10;&#10;   bzero( &#38;serverAddress, sizeof(serverAddress) );&#10;   serverAddress.sin_family = AF_INET;&#10;   serverAddress.sin_port = htons( 12345 );&#10;&#10;   inet_pton( AF_INET, &#34;127.0.0.1&#34;, &#38;serverAddress.sin_addr );&#10;&#10;   if ( connect( sockfd, (struct sockaddr *)&#38;serverAddress,   &#10;                  sizeof(serverAddress)) &#60; 0 ) &#123;&#10;      perror( &#34;connect&#34; );&#10;      exit(1);&#10;   &#125;&#10;&#10;   while ( n = read( sockfd, buffer, 200) ) &#123;&#10;      buffer[n] = 0;&#10;      printf( buffer );&#10;   &#125;&#10;&#10;   if ( n &#60; 0 ) &#123;&#10;      perror( &#34;read&#34; );&#10;      exit(1);&#10;   &#125;&#10;&#10;   return 0;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Servers">Servers</h4><p>Now we discuss the startup procedure for a server, which is slightly more complicated than what a client must do. The first step is the same – create a socket:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> sockaddr_in serverAddress;</span><br><span class="line"><span class="keyword">int</span> listenfd, connectfd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( (listenfd = socket( AF_INET, SOCK_STREAM, <span class="number">0</span> )) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">   perror( <span class="string">"socket"</span> );</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>The only thing that changed here is that we declared a second socket file descriptor variable to hold the return value of accept(), and we changed the name of the original socket file descriptor variable from sockfd to listenfd, to reflect the changed nature of the socket in a server application.</p>
<p>Next, we have to bind the socket to a port and address using the bind() function. This function takes a sockaddr_in struct, so we have to prepare one as we did for the client:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bzero( &amp;serverAddress, <span class="keyword">sizeof</span>(serverAddress) );</span><br><span class="line">serverAddress.sin_family = AF_INET;</span><br><span class="line">serverAddress.sin_port = htons( <span class="number">12345</span> );</span><br><span class="line">serverAddress.sin_addr.s_addr = htonl( INADDR_ANY );</span><br></pre></td></tr></table></figure></p>
<p>Initializing the server’s socket address structure is done in the same way as the client’s, with a few small changes. We first zero the memory space occupied by serverAddress, and then set the family, port number, and address. Notice, however, that we set the address differently than before. We could have used inet_pton() with the same localhost IP address that we used for the client, but to do so would restrict the server to accepting connections only on the localhost interface. In other words, our server would not be able to accept connections from the network, since it would only be listening for connections on the IP address 127.0.0.1.</p>
<p>There are functions that let us obtain the IP address of the Ethernet interface, but there is a better solution that will allow the socket to accept connections on any of the available interfaces (Ethernet, localhost, Airport, Firewire, etc.). By setting the address to the constant INADDR_ANY, the kernel will bind the socket to ress.sin_addr.s_addr to the network representation (obtained using htonl()) of the constant INADDR_ANY all available network interfaces. Thus, if we simultaneously have an active Ethernet connection, an active Airport connection, and the loopback interface (127.0.0.1), we will be able to connect to the socket over any of these interfaces’ respective IP addresses.</p>
<p>Next we have to bind the socket to the address specified in the struct serverAddress. This is done using the bind() function:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( bind( listenfd, (<span class="keyword">struct</span> sockaddr *)&amp;serverAddress, </span><br><span class="line">            <span class="keyword">sizeof</span>(serverAddress)) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">   perror( <span class="string">"bind"</span> );</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Like the connect() function, we pass the socket file descriptor, the socket address structure that specifies the address and port to bind to, and finally, the length of the address structure. As always, we check to see if the function executed successfully by comparing the return value to zero.</p>
<p>Next we call the listen() function to tell the socket to listen for incoming connections. By calling listen(), we are converting our socket into a passive socket that can accept connections. Calling listen() is pretty straightforward:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( listen( listenfd, <span class="number">5</span> ) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">   perror( <span class="string">"listen"</span> );</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>listen() takes two arguments: the socket file descriptor and the backlog. The backlog argument is used to limit the size of the queue for incoming connections. Thus, by passing 5 we tell the kernel to queue up to 5 pending connections. If a client attempts to connect when the queue is full, the kernel will refuse the connection, and the client’s call to connect() will return with a connection-refused error. Note that the backlog does not specify the total number of connects the server can handle, because once a connection has been accepted by the server, the request is removed from the queue, thus making room for additional connection requests.</p>
<p>The next thing we do is call the accept() function within a rudimentary run loop. What accept() does is connect to the host whose connection request is at the front of the queue, and return a socket file descriptor for this connection. We can then read and write data to the client using this new socket. Let’s take a look at how our simple server will send a message to clients:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">   <span class="keyword">char</span> *buffer = <span class="string">"Howdy!\n"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ( (connectfd = accept( listenfd, </span><br><span class="line">          (<span class="keyword">struct</span> sockaddr *)<span class="literal">NULL</span>, <span class="literal">NULL</span> )) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">      perror( <span class="string">"accept"</span> );</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ( write( connectfd, buffer, <span class="built_in">strlen</span>(buffer)) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">      perror( <span class="string">"write"</span> );</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">   &#125;    </span><br><span class="line">   close( connectfd );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>The rudimentary run loop I mentioned above is done with the infinite for loop; the server will continue waiting for connections until the user kills the process (using Ctrl-C, for example). Our server is pretty inflexible, since the message it sends to clients that connect is hard-coded, and short: “Howdy!” The message is coded as a null-terminated string. In the call to accept(), we pass the file descriptor for the listening socket (and nothing for the address structure, since we don’t need any of that information that accept() returns in this structure), and in return, accept() gives us the file descriptor for the connected socket. This socket, connectfd, is our end of the connection between the server host and the client host. This is the socket that we read data from and write data to when we communicate with the client.</p>
<p>Finally, after we send the message, we close the connected socket using the close() function and return to the top of the loop, ready to accept a new connection.</p>
<p>Now, putting all of these pieces together (with error checking in place), we have the following code for a small server application:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">char</span> **argv )</span></span><br><span class="line"></span>&#123;</span><br><span class="line">   <span class="keyword">struct</span> sockaddr_in serverAddress;</span><br><span class="line">   <span class="keyword">int</span> listenfd, connectfd;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ( (listenfd = socket( AF_INET, SOCK_STREAM, <span class="number">0</span> )) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">      perror( <span class="string">"socket"</span> );</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   bzero( &amp;serverAddress, <span class="keyword">sizeof</span>(serverAddress) );</span><br><span class="line">   serverAddress.sin_family = AF_INET;</span><br><span class="line">   serverAddress.sin_port = htons(<span class="number">12345</span>);</span><br><span class="line">   serverAddress.sin_addr.s_addr = htonl( INADDR_ANY );</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ( bind( listenfd, (<span class="keyword">struct</span> sockaddr *)&amp;serverAddress, </span><br><span class="line">               <span class="keyword">sizeof</span>(serverAddress) ) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">      perror( <span class="string">"bind"</span> );</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ( listen( listenfd, <span class="number">5</span> ) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">      perror( <span class="string">"listen"</span> );</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">      <span class="keyword">char</span> *buffer = <span class="string">"Howdy\n"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( (connectfd = accept( listenfd, </span><br><span class="line">             (<span class="keyword">struct</span> sockaddr *)<span class="literal">NULL</span>, <span class="literal">NULL</span> )) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">         perror( <span class="string">"accept"</span> );</span><br><span class="line">         <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( write( connectfd, buffer, <span class="built_in">strlen</span>(buffer) ) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">         perror( <span class="string">"write"</span> );</span><br><span class="line">         <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      close( connectfd );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And that, my friends, is our server. If you created a standard tool project for both the client and the server, you can compile and run each. Before you run the client, however, make sure you have the server running. If you want to compile and run these in a shell, type the following commands to invoke the compiler:<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% cc -o server server.c</span><br><span class="line">% cc -o client client.c</span><br></pre></td></tr></table></figure></p>
<p>When running, you might want to open a second shell so you have one for the client and one for the server. Again, make sure you have the server running (by typing ./server from the directory where you compiled the code), and then run the client (./client from the same directory). If you have trouble, here are the source files I worked with for you to play around with. If you want to see something kind of cool, try typing the following in the shell while the server is running (this, incidentally, is a good way of testing server applications):<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% telnet localhost <span class="number">12345</span></span><br></pre></td></tr></table></figure></p>
<p>So there you have it – a very simple example that shows how Unix does networking. If you’re interested at all in networking, I can’t recommend strongly enough that you pick up the book Unix Network Programming, Volume 1 by W. Richard Stevens. With the prominence of networking capabilities in most applications today, every programmer should have this book. There is a lot more to network programming than what we saw here. There are many considerations to be made for scalability, protocol independence, security, and more. This book covers it all.</p>
<p>In the next column, we’ll take what we learned here and see how we use some of the Foundation classes to make RCE an application that can actually communicate over a network.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/07/Networking-and-the-BSD-Sockets-APIs/" data-id="cifh3unoc0040wsxnuk19ol4i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Port-to-gcc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/06/Port-to-gcc/" class="article-date">
  <time datetime="2015-10-06T03:39:47.000Z" itemprop="datePublished">Oct 6 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gcc/">gcc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/06/Port-to-gcc/">ARM GCC移植指导</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述">概述</h3><p>本文主要介绍MDK代码移植到ARM GCC中的注意事项，以及对应的编译器指令</p>
<p>主要包括</p>
<ul>
<li>启动文件</li>
<li>链接脚本</li>
<li>汇编文件</li>
<li>编译器指令</li>
<li>其它</li>
</ul>
<h3 id="启动文件">启动文件</h3><p>选择适用于gcc as汇编器的启动文件，并注意添加bss的清零和data的复制代码，用于初始化C<br>runtime，如果使用到了C++，还需要手工复制构造函数表和全局变量表，并调用_start函数来初始化C lib</p>
        
          <p class="article-more-link">
            <a href="/2015/10/06/Port-to-gcc/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/06/Port-to-gcc/" data-id="cifh3unoo0046wsxn957hzqqy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Set-Up-scons-environment" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/06/Set-Up-scons-environment/" class="article-date">
  <time datetime="2015-10-06T01:49:41.000Z" itemprop="datePublished">Oct 6 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/scons/">scons</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/06/Set-Up-scons-environment/">建立scons开发环境</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述">概述</h3><p>本文重点介绍win7环境下安装arm gcc编译器和scons编译系统的过程</p>
<p>注意：对于arm gcc和scons的介绍信息，请参考本博客《arm gcc简介》，《scons系统简介》</p>
<h3 id="安装步骤">安装步骤</h3><h4 id="1-_安装gcc">1. 安装gcc</h4><p>这里采用launchapad的arm-none-eabi-gcc，官网<a href="https://launchpad.net/gcc-arm-embedded/" target="_blank" rel="external">https://launchpad.net/gcc-arm-embedded/</a><br>进入<a href="https://launchpad.net/gcc-arm-embedded/+download" target="_blank" rel="external">下载页面</a>， 根据自己的系统，选择对应的版本，我这里下载32位最新版4.9<a href="https://launchpad.net/gcc-arm-embedded/4.9/4.9-2015-q3-update/+download/gcc-arm-none-eabi-4_9-2015q3-20150921-win32.exe" target="_blank" rel="external">gcc-arm-none-eabi-4_9-2015q3-20150921-win32.exe</a></p>
<p>点击安装，一路next，保持默认安装路径，安装完成界面，会有4个复选框，勾选</p>
<ul>
<li><code>Add path to environment variable</code></li>
<li><code>Add registry information</code><br>点击完成，arm gcc安装完成</li>
</ul>
<h4 id="2-_安装python_2-xx">2. 安装python 2.xx</h4><p><strong>注意:</strong> 一定要安装2.xx版本的python<br>进入python下载页面<a href="https://www.python.org/downloads/release/python-2710/，" target="_blank" rel="external">https://www.python.org/downloads/release/python-2710/，</a> 选择对应系统的python<br>这里选择32位2.7自安装包版本<br><a href="https://www.python.org/ftp/python/2.7.10/python-2.7.10.msi" target="_blank" rel="external">https://www.python.org/ftp/python/2.7.10/python-2.7.10.msi</a></p>
<p>点击安装，一路next，保持默认安装路径和配置选项，直到安装完成</p>
<h4 id="3-_安装scons">3. 安装scons</h4><p>进入scons下载页面<a href="http://www.scons.org/download.php" target="_blank" rel="external">http://www.scons.org/download.php</a><br>下载2.4版本的windows安装包<a href="http://prdownloads.sourceforge.net/scons/scons-2.4.0-setup.exe" target="_blank" rel="external">http://prdownloads.sourceforge.net/scons/scons-2.4.0-setup.exe</a></p>
<p>点击安装，一路next，保持默认安装路径和配置选项，直到安装完成</p>
<h4 id="4-_更新环境变量">4. 更新环境变量</h4><p>打开系统环境变量配置页<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">开始－》计算机－》属性－》高级系统设置－》环境变量－》系统变量－》<span class="built_in">Path</span>－》编辑</span><br></pre></td></tr></table></figure></p>
<p>检查Path是否有下面三项，没有则添加<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Python27</span>;<span class="title">C</span>:\<span class="title">Python27</span>\<span class="title">Scripts</span>;<span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">GNU</span> <span class="title">Tools</span> <span class="title">ARM</span> <span class="title">Embedded</span>\4.9 2015<span class="title">q3</span>\<span class="title">bin</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>: Path 用<code>;</code>来分割路径</p>
<h4 id="5-_测试系统">5. 测试系统</h4><p>打开Cmd窗口，输入<code>arm-none-eabi-gcc -v</code>, <code>python -V</code>, <code>scons -v</code><br><strong>注意</strong>: <code>python -V</code>中的V要大写</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users&gt; arm-none-eabi-gcc -v</span><br><span class="line">Using built-<span class="flow">in</span> specs.</span><br><span class="line">COLLECT_GCC=C:\Program Files\GNU Tools ARM Embedded\<span class="number">4</span>.<span class="number">9</span> <span class="number">2015</span>q3\bin\arm-none-eabi-gcc.exe</span><br><span class="line">COLLECT_LTO_WRAPPER=c:/program\ files/gnu\ tools\ arm\ embedded/<span class="number">4</span>.<span class="number">9</span>\ <span class="number">2015</span>q3/bin/../lib/gcc/arm-none-eabi/<span class="number">4</span>.<span class="number">9</span>.<span class="number">3</span>/lto-wrapp</span><br><span class="line">er.exe</span><br><span class="line"><span class="function">Target: <span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span></span><br><span class="line"><span class="title">Configured</span> <span class="title">with</span>: /<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">src</span>/<span class="title">gcc</span>/<span class="title">configure</span> --<span class="title">build</span>=<span class="title">i686</span>-<span class="title">linux</span>-<span class="title">gnu</span> --<span class="title">host</span>=<span class="title">i686</span>-<span class="title">w64</span>-<span class="title">mingw32</span> --<span class="title">targe</span></span><br><span class="line"><span class="title">t</span>=<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span> --<span class="title">prefix</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">install</span>-<span class="title">mingw</span> --<span class="title">libexecdir</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">instal</span></span><br><span class="line"><span class="title">l</span>-<span class="title">mingw</span>/<span class="title">lib</span> --<span class="title">infodir</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">install</span>-<span class="title">mingw</span>/<span class="title">share</span>/<span class="title">doc</span>/<span class="title">gcc</span>-<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span>/<span class="title">info</span> --<span class="title">mandir</span>=/<span class="title">home</span>/<span class="title">build</span></span><br><span class="line">/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">install</span>-<span class="title">mingw</span>/<span class="title">share</span>/<span class="title">doc</span>/<span class="title">gcc</span>-<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span>/<span class="title">man</span> --<span class="title">htmldir</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">install</span>-<span class="title">mingw</span></span><br><span class="line">/<span class="title">share</span>/<span class="title">doc</span>/<span class="title">gcc</span>-<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span>/<span class="title">html</span> --<span class="title">pdfdir</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">install</span>-<span class="title">mingw</span>/<span class="title">share</span>/<span class="title">doc</span>/<span class="title">gcc</span>-<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span>/<span class="title">pdf</span></span><br><span class="line">--<span class="title">enable</span>-<span class="title">languages</span>=<span class="title">c</span>,<span class="title">c</span>++ --<span class="title">disable</span>-<span class="title">decimal</span>-<span class="title">float</span> --<span class="title">disable</span>-<span class="title">libffi</span> --<span class="title">disable</span>-<span class="title">libgomp</span> --<span class="title">disable</span>-<span class="title">libmudflap</span> --<span class="title">disable</span>-<span class="title">libqu</span></span><br><span class="line"><span class="title">admath</span> --<span class="title">disable</span>-<span class="title">libssp</span> --<span class="title">disable</span>-<span class="title">libstdcxx</span>-<span class="title">pch</span> --<span class="title">disable</span>-<span class="title">nls</span> --<span class="title">disable</span>-<span class="title">shared</span> --<span class="title">disable</span>-<span class="title">threads</span> --<span class="title">disable</span>-<span class="title">tls</span> --<span class="title">with</span>-<span class="title">gn</span></span><br><span class="line"><span class="title">u</span>-<span class="title">as</span> --<span class="title">with</span>-<span class="title">gnu</span>-<span class="title">ld</span> --<span class="title">with</span>-<span class="title">headers</span>=<span class="title">yes</span> --<span class="title">with</span>-<span class="title">newlib</span> --<span class="title">with</span>-<span class="title">python</span>-<span class="title">dir</span>=<span class="title">share</span>/<span class="title">gcc</span>-<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span> --<span class="title">with</span>-<span class="title">sysroot</span>=/<span class="title">home</span>/<span class="title">build</span></span><br><span class="line">/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">install</span>-<span class="title">mingw</span>/<span class="title">arm</span>-<span class="title">none</span>-<span class="title">eabi</span> --<span class="title">with</span>-<span class="title">libiconv</span>-<span class="title">prefix</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">build</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">l</span></span><br><span class="line"><span class="title">ibs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">gmp</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">build</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">libs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">mpfr</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">b</span></span><br><span class="line"><span class="title">uild</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">libs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">mpc</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">build</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">libs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">isl</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span></span><br><span class="line">/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">build</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">libs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">cloog</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">build</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">libs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">li</span></span><br><span class="line"><span class="title">belf</span>=/<span class="title">home</span>/<span class="title">build</span>/<span class="title">work</span>/<span class="title">GCC</span>-4-9-<span class="title">build</span>/<span class="title">build</span>-<span class="title">mingw</span>/<span class="title">host</span>-<span class="title">libs</span>/<span class="title">usr</span> --<span class="title">with</span>-<span class="title">host</span>-<span class="title">libstdcxx</span>='-<span class="title">static</span>-<span class="title">libgcc</span> -<span class="title">Wl</span>,-<span class="title">Bstatic</span>,-<span class="title">lstdc</span>+</span><br><span class="line">+,-<span class="title">Bdynamic</span> -<span class="title">lm</span>' --<span class="title">with</span>-<span class="title">pkgversion</span>='<span class="title">GNU</span> <span class="title">Tools</span> <span class="title">for</span> <span class="title">ARM</span> <span class="title">Embedded</span> <span class="title">Processors</span>' --<span class="title">with</span>-<span class="title">multilib</span>-<span class="title">list</span>=<span class="title">armv6</span>-<span class="title">m</span>,<span class="title">armv7</span>-<span class="title">m</span>,<span class="title">armv7e</span>-<span class="title">m</span></span><br><span class="line">,<span class="title">cortex</span>-<span class="title">m7</span>,<span class="title">armv7</span>-<span class="title">r</span></span><br><span class="line"><span class="title">Thread</span> <span class="title">model</span>: <span class="title">single</span></span><br><span class="line"><span class="title">gcc</span> <span class="title">version</span> 4.9.3 20150529 (<span class="title">release</span>) [<span class="title">ARM</span>/<span class="title">embedded</span>-4<span class="title">_9</span>-<span class="title">branch</span> <span class="title">revision</span> 227977] (<span class="title">GNU</span> <span class="title">Tools</span> <span class="title">for</span> <span class="title">ARM</span> <span class="title">Embedded</span> <span class="title">Processors</span>)</span><br><span class="line"><span class="title">PS</span> <span class="title">C</span>:\<span class="title">Users</span>&gt; <span class="title">python</span> -<span class="title">V</span></span><br><span class="line"><span class="title">Python</span> 2.7.10</span><br><span class="line"><span class="title">PS</span> <span class="title">C</span>:\<span class="title">Users</span>&gt; <span class="title">scons</span> -<span class="title">v</span></span><br><span class="line"><span class="title">SCons</span> <span class="title">by</span> <span class="title">Steven</span> <span class="title">Knight</span> <span class="title">et</span> <span class="title">al</span>.:</span><br><span class="line">        <span class="title">script</span>: <span class="title">v2</span>.4.0.<span class="title">rel_2</span>.4.0:3365:9259<span class="title">ea1c13d7</span>, 2015/09/21 14:03:43, <span class="title">by</span> <span class="title">bdbaddog</span> <span class="title">on</span> <span class="title">hpmicrodog</span></span><br><span class="line">        <span class="title">engine</span>: <span class="title">v2</span>.4.0.<span class="title">rel_2</span>.4.0:3365:9259<span class="title">ea1c13d7</span>, 2015/09/21 14:03:43, <span class="title">by</span> <span class="title">bdbaddog</span> <span class="title">on</span> <span class="title">hpmicrodog</span></span><br><span class="line">        <span class="title">engine</span> <span class="title">path</span>: ['<span class="title">C</span>:\\<span class="title">Python27</span>\\<span class="title">scons</span>-2.4.0\\<span class="title">SCons</span>']</span><br><span class="line"><span class="title">Copyright</span> (<span class="title">c</span>) 2001 - 2015 <span class="title">The</span> <span class="title">SCons</span> <span class="title">Foundation</span></span><br><span class="line"><span class="title">PS</span> <span class="title">C</span>:\<span class="title">Users</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>至此，所有的系统配置已经完成</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/06/Set-Up-scons-environment/" data-id="cifh3unoe0043wsxnhws670or" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Use-gdb-debug-cortex-m-mcu-via-jlink-gdb-server" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/04/Use-gdb-debug-cortex-m-mcu-via-jlink-gdb-server/" class="article-date">
  <time datetime="2015-10-04T12:17:54.000Z" itemprop="datePublished">Oct 4 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Jlink/">Jlink</a>►<a class="article-category-link" href="/categories/Jlink/gcc/">gcc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/04/Use-gdb-debug-cortex-m-mcu-via-jlink-gdb-server/">用gdb调试Cortex-M系列芯片</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="准备工作">准备工作</h3><p>本文假设读者</p>
<ol>
<li>已经熟悉arm gcc工具链</li>
<li>已经在win中安装好mingw或者arm-none-eabi-gcc工具</li>
<li>具有合适的代码工程和编译脚本，且编译输出elf文件时，已添加<code>-g</code>选项来生成调试信息</li>
<li>安装jlink调试工具和对应驱动</li>
<li>有对应的硬件电路</li>
</ol>
<p>如果其中任何一项不满足，请自行google相关文档，完成基础准备工作</p>
<h3 id="启动jlink_gdb_server">启动jlink gdb server</h3><ol>
<li>开始 -&gt; SEGGER -&gt; Jlink V4.90e -&gt; Jlink GDB Server</li>
<li>Jlink会显示GDB config配置选项，如下图配置<br><img src="http://cedar-renjun.github.io/images/2015/10/4/1.png" alt="GDB Server配置选项"></li>
<li>点击OK，启动GDB server，在J-Link一栏会显示<code>Connected</code>字符，表示成功连接硬件，如下图所示<br><img src="http://cedar-renjun.github.io/images/2015/10/4/2.png" alt="GDB Server配置完成"></li>
</ol>
<h3 id="启动GDB">启动GDB</h3><ol>
<li>打开CMD，输入<code>arm-none-eabi-gdb</code>，打开后，如下图所示；如果没有显示对应信息，属于没有配置环境变量的path，请添加gcc<br>tools的路径进去</li>
<li>输入<code>file Demo.elf</code>加载调试文件，这里以<code>Demo.elf</code>为例，实际你可以替换为自己的elf文件</li>
<li>输入<code>target remote localhost:2331</code>，连接gdb server，连接成功后，会在Jlink GDB server中显示对应的状态，如下所示<br><img src="http://cedar-renjun.github.io/images/2015/10/4/3.png" alt="GDB Server连接成功"></li>
<li>输入<code>monitor reset</code>来复位MCU，从而让MCU处于确定的状态</li>
<li>输入<code>load</code>往MCU中加载调试文件，也就是常见的烧录过程</li>
<li>输入<code>break main</code>设置main断点，让MCU执行到main中停止</li>
</ol>
<p>下面是使用Power shell的交互过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; arm-none-eabi-gdb</span><br><span class="line">GNU gdb (GNU Tools <span class="keyword">for</span> ARM Embedded Processors) <span class="number">7.8</span>.<span class="number">0.20150604</span>-cvs</span><br><span class="line">Copyright (C) <span class="number">2014</span> Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version <span class="number">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">"show copying"</span></span><br><span class="line">and <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"--host=i686-w64-mingw32 --target=arm-none-eabi"</span>.</span><br><span class="line">Type <span class="string">"show configuration"</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">"help"</span>.</span><br><span class="line">Type <span class="string">"apropos word"</span> to search <span class="keyword">for</span> commands related to <span class="string">"word"</span>.</span><br><span class="line">(gdb) file Demo.elf</span><br><span class="line">Reading symbols from Demo.elf...done.</span><br><span class="line">(gdb) target remote localhost:<span class="number">2331</span></span><br><span class="line">Remote debugging using localhost:<span class="number">2331</span></span><br><span class="line"><span class="number">0</span>x00000000 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) monitor reset</span><br><span class="line">Resetting target</span><br><span class="line">(gdb) load</span><br><span class="line">Loading section .text, size <span class="number">0</span>x434 lma <span class="number">0</span>x8000000</span><br><span class="line">Loading section .data, size <span class="number">0</span>x14 lma <span class="number">0</span>x8000434</span><br><span class="line">Start address <span class="number">0</span>x80003ec, load size <span class="number">1096</span></span><br><span class="line">Transfer rate: <span class="number">59</span> KB/sec, <span class="number">548</span> bytes/write.</span><br><span class="line">(gdb) <span class="built_in">break</span> main</span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0</span>x8000112: file src\App\main.c, line <span class="number">27</span>.</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">1</span>, main () at src\App\main.c:<span class="number">27</span></span><br><span class="line"><span class="number">27</span>              int i = <span class="number">0</span>;</span><br><span class="line">(gdb) l</span><br><span class="line"><span class="number">22</span>      /* Includes ------------------------------------------------------------------*/</span><br><span class="line"><span class="number">23</span>      <span class="comment">#include "stm32f10x.h"</span></span><br><span class="line"><span class="number">24</span>      <span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="number">25</span>      int main(void)</span><br><span class="line"><span class="number">26</span>      &#123;</span><br><span class="line"><span class="number">27</span>              int i = <span class="number">0</span>;</span><br><span class="line"><span class="number">28</span></span><br><span class="line"><span class="number">29</span></span><br><span class="line"><span class="number">30</span>              <span class="keyword">for</span>(int m = <span class="number">0</span>; m &lt; <span class="number">100</span>; m++)</span><br><span class="line"><span class="number">31</span>              &#123;</span><br><span class="line">(gdb) l</span><br><span class="line"><span class="number">32</span>                      i = m + i;</span><br><span class="line"><span class="number">33</span>              &#125;</span><br><span class="line"><span class="number">34</span></span><br><span class="line"><span class="number">35</span>              <span class="built_in">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">36</span>      &#125;</span><br><span class="line">(gdb) s</span><br><span class="line"><span class="number">30</span>              <span class="keyword">for</span>(int m = <span class="number">0</span>; m &lt; <span class="number">100</span>; m++)</span><br><span class="line">(gdb) s</span><br><span class="line"><span class="number">32</span>                      i = m + i;</span><br><span class="line">(gdb) s</span><br><span class="line"><span class="number">30</span>              <span class="keyword">for</span>(int m = <span class="number">0</span>; m &lt; <span class="number">100</span>; m++)</span><br><span class="line">(gdb) s</span><br><span class="line"><span class="number">32</span>                      i = m + i;</span><br><span class="line">(gdb) p m</span><br><span class="line"><span class="variable">$1</span> = <span class="number">1</span></span><br><span class="line">(gdb) <span class="built_in">break</span> <span class="number">35</span></span><br><span class="line">Breakpoint <span class="number">2</span> at <span class="number">0</span>x8000130: file src\App\main.c, line <span class="number">35</span>.</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">2</span>, main () at src\App\main.c:<span class="number">35</span></span><br><span class="line"><span class="number">35</span>              <span class="built_in">return</span> <span class="number">0</span>;</span><br><span class="line">(gdb) p i</span><br><span class="line"><span class="variable">$2</span> = <span class="number">4950</span></span><br><span class="line">(gdb) q</span><br><span class="line">A debugging session is active.</span><br><span class="line"></span><br><span class="line">        Inferior <span class="number">1</span> [Remote target] will be killed.</span><br><span class="line"></span><br><span class="line">Quit anyway? (y or n) y</span><br></pre></td></tr></table></figure>
<h3 id="参考资料：">参考资料：</h3><ol>
<li>gcc manual</li>
<li>gdb manual</li>
<li>jlink user manual, charapter 3.3 J-link GDB Server</li>
<li>scons user guide</li>
<li>scons manual</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/04/Use-gdb-debug-cortex-m-mcu-via-jlink-gdb-server/" data-id="cifh3unor0049wsxnpbclvlcg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Create-your-IAR-project-template" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/02/Create-your-IAR-project-template/" class="article-date">
  <time datetime="2015-10-02T05:29:55.000Z" itemprop="datePublished">Oct 2 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IAR/">IAR</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/02/Create-your-IAR-project-template/">创建IAR模版工程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="前言">前言</h3><p>如果你用过IAR，用过STM32，那一定会知道创建新STM32工程时有多痛苦，创建空工程，添加group，添加代码，添加宏定义，选择STM32芯片等步骤<br>每次新建工程，都需要重新来一遍，那有没有更简单的步骤呢？答案是yes！</p>
<p>假设我们需要在IAR中添加一个STM32F4的工程模版，那么所需要的东西如下：</p>
<ol>
<li>IAR 7.20 For ARM</li>
<li>Win7</li>
<li>STM32F4xx 标准库文件</li>
</ol>
<p>基本步骤包括</p>
<ol>
<li>创建IAR标准模版工程</li>
<li>把模版放到IAR安装目录（patch）</li>
<li>修改配置文件</li>
</ol>
<p>很简单，让我们一步一步来实现这个功能</p>
<h3 id="1_创建IAR标准工程">1 创建IAR标准工程</h3><p>像平时一样，根据自己的工程管理习惯，用IAR创建一个工程，然后调整代码和相关工程配置项，调试编译通过</p>
<p><strong>特别注意：创建工程时，需要保证IAR工程文件在最顶层目录</strong><br><img src="http://cedar-renjun.github.io/images/2015/10/3/1.png" alt="工程目录组织结构"></p>
<p>创建好的目录如下所示</p>
<p><img src="http://cedar-renjun.github.io/images/2015/10/3/0.png" alt="创建好的IAR工程"></p>
<h3 id="2_添加模版工程">2 添加模版工程</h3><p>接下来，我们需要将标准工程修改为模版工程</p>
<ol>
<li>删除<code>Debug</code>和<code>settings</code>目录，某些情况下，还有存在<code>Release</code>目录，请删除</li>
<li>删除<code>*.dep</code>, <code>*.ewt</code>, <code>*.ewd</code>,<code>*.eww</code>四种IAR工程文件，只保留<code>*.ewp</code>文件<br>关于上面5种文件的详细分析，请参考本博客上篇文章<a href="http://cedar-renjun.github.io/2015/10/02/IAR-projects-template/">IAR工程文件分析</a></li>
<li>修改<code>*.ewp</code>文件名为<code>templproj.ewp</code></li>
</ol>
<p>至此，修改完成，如下图所示<br><img src="http://cedar-renjun.github.io/images/2015/10/3/3.png" alt="修改好的IAR工程"></p>
<h3 id="3_修改配置文件">3 修改配置文件</h3><p>接下来，我们将这个模块添加到IAR工程中</p>
<ol>
<li>在桌面新建一个临时文件夹，名为<code>tmp</code></li>
<li>在<code>tmp</code>中新建目录<code>STM32</code>,</li>
<li>在<code>STM32</code>中新建目录<code>F4xx</code></li>
<li><p>将我们创建的模版工程拷入<code>F4xx</code>目录，如下所示</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">│ </span><br><span class="line">└─STM32</span><br><span class="line">    │ </span><br><span class="line">    └─F4xx</span><br><span class="line">        │ templproj.ewp</span><br><span class="line">        ├─App</span><br><span class="line">        └─Libs</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入<code>C:\Program Files\IAR Systems\Embedded Workbench 7.2\arm\config\template\project</code>目录，拷贝<code>C.ENU.projtempl</code>文件到<code>STM32</code>和<code>F4xx</code>同级目录，然后修改名字为<code>STM32.ENU.projtempl</code>,<code>F4xx.ENU.projtempl</code>，修改完成后，结构如下所示</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">│ STM32.ENU.projtempl</span><br><span class="line">└─STM32</span><br><span class="line">    │ F4xx.ENU.projtempl</span><br><span class="line">    └─F4xx</span><br><span class="line">        │ templproj.ewp</span><br><span class="line">        ├─App</span><br><span class="line">        └─Libs</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>特别注意：<code>projtempl</code>的名字一定要和目录名字完全一致，不然IAR找不到对应的文件夹</strong><br><code>*.projtempl</code>文件用于展示工程模版的基本信息，比如名字和简介什么的<br>下面我们分别将两个文件修改为下面样式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--STM32.ENU.projtempl file--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">templategroup</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="title">description</span>&gt;</span>STM32 Project template for f0/1/2/4/7 mcu<span class="tag">&lt;/<span class="title">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">displayname</span>&gt;</span>STM32<span class="tag">&lt;/<span class="title">displayname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">templategroup</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--F4xx.ENU.projtempl file--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">templategroup</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="title">description</span>&gt;</span>STM32 Project template for f4xx mcu<span class="tag">&lt;/<span class="title">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">displayname</span>&gt;</span>F4xx<span class="tag">&lt;/<span class="title">displayname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">templategroup</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="测试">测试</h3><p>上面几个步骤，看起来很复杂，但实际操作起来，也挺简单的</p>
<p>下面我们来测试效果，将上面<code>tmp</code>文件中所有文件，拷贝至<code>C:\Program Files\IAR Systems\Embedded Workbench 7.2\arm\config\template\project</code>目录</p>
<p>在IAR中，新建工程，这时便会出现STM32模版工程，如下图所示<br><img src="http://cedar-renjun.github.io/images/2015/10/3/6.png" alt="选择工程模版"></p>
<p>选择STM32，然后选择F4，新建工程，完成后如下图所示，finish<br><img src="http://cedar-renjun.github.io/images/2015/10/3/7.png" alt="新建的IAR工程"></p>
<h3 id="后记">后记</h3><p>在IAR 7.2上测试时，时常出现不可复现的bug，也许和破解有关系，具体表现为<br>在显示层次模版目录时，无法显示子目录；UI层次上就是新建IAR工程时，能显示STM32模版，但不能显示F4xx模版信息</p>
<p>暂时无解</p>
<p>规避方案：直接复制IAR模版文件，然后适当修改即可，千万不要重写<code>templproj</code>!!!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/02/Create-your-IAR-project-template/" data-id="cifh3unou004hwsxnsn5tgddn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-IAR-projects-template" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/02/IAR-projects-template/" class="article-date">
  <time datetime="2015-10-02T02:35:55.000Z" itemprop="datePublished">Oct 2 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IAR/">IAR</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/02/IAR-projects-template/">IAR 工程文件分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>注意：下文以IAR 7.2 For ARM版本来分析XML工程文件</p>
<h3 id="初衷">初衷</h3><p>IAR工程中添加文件，一直很麻烦，最近发现RTT用Scons能自动生成IAR模版，并添加源文件，为此分析了IAR工程管理结构，重点在于源文件管理结构</p>
<h3 id="构建语法">构建语法</h3><p>采用标准XML形式来构建工程</p>
<p>在新建工程后，IAR默认包含debug和release两个模版，在XML文件中，有所体现，我们可以在XML中删掉release的配置信息，减轻我们分析的负担</p>
<h3 id="IAR_工程结构">IAR 工程结构</h3><ul>
<li>*.ewp IAR工程文件，包含配置项和文件列表</li>
<li>*.ewt IAR配置文件，包含C-STAT和RuntimeChecking的信息</li>
<li>*.dep IAR调试信息配置，主要用于描述源文件和obj文件的关联信息</li>
<li>*.eww IAR workspace，用于管理多个project</li>
<li>*.ewd 调试相关，比如选择的调试器和调试器ID等等</li>
</ul>
<p>简单介绍一下用途<br>1）如果只是保留基本工程信息，不需要调试器和链接器的信息，只保留<code>eww</code>和<code>ewp</code>文件即可<br>2）如果需要保存链接器和调试器信息，保留<code>ewp</code>, <code>ewt</code>, <code>dep</code>, <code>eww</code>四个文件即可<br>3）<code>ewt</code>主要包含一些静态检查和动态检查，可以不用这些配置项</p>
<p>也就是说，在复制IAR工程时，只需要保留这几个文件，其它的文件（夹）都可以删掉，比如setting, Debug，Release文件夹</p>
<p>因为分析IAR主要是为了自动生成模版文件，所以下面重点分析<code>ewp</code>文件结构</p>
<h3 id="ewp文件分析">ewp文件分析</h3><p>打开文件，可以看到顶层结构为<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">project</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">fileVersion</span>&gt;</span>2<span class="tag">&lt;/<span class="title">fileVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span>Debug工程配置<span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span>Release工程配置<span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">file</span>&gt;</span>工程文件结构<span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里加注了行号，第3/4行为工程具体配置，包括<code>Debug</code>和<code>Release</code>版本配置，还可以添加其它配置页，为了简化分析，我删掉了<code>Release</code>配置项，再次打开IAR工程，如下所示：</p>
<p>第5行是工程文件目录结构，也是我们重点分析的部分，主要分为两块</p>
<ol>
<li>单个文件</li>
<li>目录组织结构</li>
</ol>
<p>我在创建IAR工程时，只包含一个main.c文件，XML对应结构如下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\main.c<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>尝试添加两个源文件<code>test.c</code> <code>test.h</code>, XML 结构变成下面的形式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\main.c<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\test.c<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\test.h<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可见每一个文件对应一个file结构，我们尝试新建一个group，然后将test.c和test.h文件放到里面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>test<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\test.c<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\test.h<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>$PROJ_DIR$\main.c<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可见增加了一个<code>group</code>结构，并用<code>name</code>来表示group的名字<br>OK，分析到这里，我们就可以利用python来编写脚本自动添加文件到IAR工程中了</p>
<p>至于<code>Debug</code>配置项的细节信息，等有机会慢慢研究</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/02/IAR-projects-template/" data-id="cifh3unos004ewsxnwh1krakv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Introduce-Raspberry-2B" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/01/Introduce-Raspberry-2B/" class="article-date">
  <time datetime="2015-10-01T13:25:40.000Z" itemprop="datePublished">Oct 1 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/树莓派/">树莓派</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/01/Introduce-Raspberry-2B/">“树莓派2B＋学习笔记-开篇”</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言">前言</h2><p>github这个博客好久更新了，大概有一年吧，期间各种事情，其实主要原因还是自己懒<br>终究发现做技术的，还是要常常做一些笔记，不然就会容易忘记，所以今天重抄旧业，将hexo升级到了3.1.0</p>
<p>接下来会不断更新蓝牙4.0和linux，USB相关知识</p>
<p>先拿树莓派开刀吧^_^</p>
<h2 id="1_致谢">1 致谢</h2><p>最近一直想学linux驱动编程和学习内核，刚好得到一块儿树莓派2B，所以准备用心搞一下<br>在此特意感谢21ic 小跑堂美女和may美女</p>
<p><img src="http://cedar-renjun.github.io/images/2015/10/1/Pi_2_Model_B.png" alt="树莓派图片"></p>
<h2 id="2_树莓派2B升级了什么">2 树莓派2B升级了什么</h2><p>下面是官方网站展示的2B的性能参数：</p>
<ul>
<li>A 900MHz quad-core ARM Cortex-A7 CPU</li>
<li>1GB RAM</li>
<li>4 USB ports</li>
<li>40 GPIO pins</li>
<li>Full HDMI port</li>
<li>Ethernet port</li>
<li>Combined 3.5mm audio jack and composite video</li>
<li>Camera interface (CSI)</li>
<li>Display interface (DSI)</li>
<li>Micro SD card slot</li>
<li>VideoCore IV 3D graphics core</li>
</ul>
<p>相比于前代的树莓派，2B采用TF卡，尺寸更小，也去掉了不常用的RCA接口（俗称AV接口），完全采用HDMI接口<br>这么改，最大的好处就是树莓派形状变得很整齐，不再像原来那样突起一部分</p>
<p>从处理器来说，将原来的高通BCM2835更新到了BCM2836，增大RAM到1G，估计你对这些也不太感冒，只要知道速度提高了6倍就好了</p>
<p>因为处理器架构从ARM7TMDI变成了4核A7，所以能跑标准的操作系统，比如安卓或者ubuntu或者win10</p>
<p>大致看了win10烧录内核的步骤，看到“首先你需要一台运行win10的笔记本”，看到这里就没继续看了，哪位有兴趣的可以自己根据官方博客来实战游戏</p>
<p><a href="https://www.raspberrypi.org/blog/windows-10-for-iot/" target="_blank" rel="external">https://www.raspberrypi.org/blog/windows-10-for-iot/</a> <br><br><a href="https://dev.windows.com/zh-cn/iot" target="_blank" rel="external">https://dev.windows.com/zh-cn/iot</a> <br></p>
<p>对了，树莓派2B支持DSI显示接口和CSI相机接口，从而可以直接高速视频输入和屏幕输出<br>这个有什么用呢？理论上来说，你可以拿树莓派做一个平板电脑</p>
<p>树莓派的简单介绍到这里，接下来介绍烧录系统，更新内核，跑opencv做人脸识别</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2015/10/01/Introduce-Raspberry-2B/" data-id="cifh3unow004jwsxnu3hbl8vn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-coding-standard" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/11/16/coding-standard/" class="article-date">
  <time datetime="2014-11-16T08:47:24.000Z" itemprop="datePublished">Nov 16 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/教程/">教程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/11/16/coding-standard/">C语言编码规范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="0_头文件注释">0 头文件注释</h2><p><strong>原则</strong><br>用于说明本文件的用途，作者，协议等信息</p>
<p><strong>示例</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//******************************************************************************************</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! \file   FIFO.h</span></span><br><span class="line"><span class="comment">//! \brief  Genernal FIFO Model Interface.</span></span><br><span class="line"><span class="comment">//!         You can use uniform FIFO Model to manager Any type of data element.</span></span><br><span class="line"><span class="comment">//! \author cedar</span></span><br><span class="line"><span class="comment">//! \date   2013-12-16</span></span><br><span class="line"><span class="comment">//! \email  xuesong5825718@gmail.com</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! \license</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! Copyright (c) 2013 Cedar MIT License</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! Permission is hereby granted, free of charge, to any person obtaining a copy</span></span><br><span class="line"><span class="comment">//! of this software and associated documentation files (the "Software"), to deal</span></span><br><span class="line"><span class="comment">//! in the Software without restriction, including without limitation the rights to</span></span><br><span class="line"><span class="comment">//! use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of</span></span><br><span class="line"><span class="comment">//! the Software, and to permit persons to whom the Software is furnished to do so,</span></span><br><span class="line"><span class="comment">//! subject to the following conditions:</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! The above copyright notice and this permission notice shall be included in all</span></span><br><span class="line"><span class="comment">//! copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></span><br><span class="line"><span class="comment">//! IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></span><br><span class="line"><span class="comment">//! FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></span><br><span class="line"><span class="comment">//! AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></span><br><span class="line"><span class="comment">//! LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></span><br><span class="line"><span class="comment">//! OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</span></span><br><span class="line"><span class="comment">//! IN THE SOFTWARE.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">//******************************************************************************************</span></span><br></pre></td></tr></table></figure>
<h2 id="1_头文件防冲突宏">1 头文件防冲突宏</h2><p><strong>原则</strong><br>用于防止头文件被多次包含，从而导致编译，链接错误</p>
        
          <p class="article-more-link">
            <a href="/2014/11/16/coding-standard/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/11/16/coding-standard/" data-id="cifh3unoy004mwsxngj0otr9u" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iar-warming-25-problem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/28/iar-warming-25-problem/" class="article-date">
  <time datetime="2014-10-28T12:30:05.000Z" itemprop="datePublished">Oct 28 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IAR/">IAR</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/28/iar-warming-25-problem/">IAR Warming 25 Problem</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="出现问题">出现问题</h2><p>IAR版本之间不兼容是臭名昭著的问题，在IAR7.0版本完全正常的代码，放到IAR7.10版本中编译，会出现下面的警告</p>
<pre><code>Warning[<span class="number">25</span>]: Label <span class="string">'MemManage_Handler'</span> is defined pubweak <span class="keyword">in</span> <span class="tag">a</span> <span class="tag">section</span> implicitly declared root
</code></pre><h2 id="解决方案">解决方案</h2><p>在对应的SECTION声明中，添加<code>NOROOT</code>修饰信息，如下所示</p>
<p>由</p>
<pre><code>        PUBWEAK MemManage_Handler
        SECTION <span class="class">.text</span>:CODE:<span class="function"><span class="title">REORDER</span><span class="params">(<span class="number">1</span>)</span></span>
MemManage_Handler
        B MemManage_Handler
</code></pre><p>改为</p>
<pre><code>        PUBWEAK MemManage_Handler
        SECTION <span class="class">.text</span>:CODE:REORDER:<span class="function"><span class="title">NOROOT</span><span class="params">(<span class="number">1</span>)</span></span>
MemManage_Handler
        B MemManage_Handler
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/28/iar-warming-25-problem/" data-id="cifh3unoz004pwsxnvpfaj1ca" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C-语言/">C 语言</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IAR/">IAR</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jlink/">Jlink</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Jlink/gcc/">gcc</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mbed/">Mbed</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/QT/">QT</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/STM32F7/">STM32F7</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SWD/">SWD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc/">gcc</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github/">github</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/github/octopress/">octopress</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/scons/">scons</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/socket/">socket</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/思维训练/">思维训练</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/教程/Doxygen/">Doxygen</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/IAR/">IAR</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/SublimeText/">SublimeText</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/Zigbee/">Zigbee</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/框架/">框架</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/开源/">开源</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/树莓派/">树莓派</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/示波器/">示波器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/转载/励志/">励志</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/方法论/">方法论</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/管理/">管理</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Cedar<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/plan" class="mobile-nav-link">Plan</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>