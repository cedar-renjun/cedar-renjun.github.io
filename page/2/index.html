<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Enjoy Programming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Enjoy Programming">
<meta property="og:url" content="http://cedar-renjun.github.io/page/2/index.html">
<meta property="og:site_name" content="Enjoy Programming">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Enjoy Programming">
<meta name="twitter:description">
  
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Enjoy Programming</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Focus On Embedded System</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/plan">Plan</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://cedar-renjun.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-use-swd-interface-to-measure-time" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/16/use-swd-interface-to-measure-time/" class="article-date">
  <time datetime="2014-10-16T13:38:17.000Z" itemprop="datePublished">Oct 16 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SWD/">SWD</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/16/use-swd-interface-to-measure-time/">用SWD调试接口测量代码运行时间</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="关于时间测量的种种问题">关于时间测量的种种问题</h2><p>在嵌入式中，我们经常需要测量某段代码的执行时间或测量事件触发的时间，常规的思路是：</p>
<p>1：在测量起始点，反转电平<br>2：在测量结束点，再次反转电平</p>
<p>然后通过示波器或者逻辑分析仪来测量反转间隔，也就是代码时间</p>
<p>这种方法，在测量两个或多个时间信号同步的时候，非常有用，实际上，这也是唯一的方法。</p>
<p>但是如果在测量中，其它代码也会控制这个管脚电平或者周期性动作，这时便需要在&lt;动作1&gt;之前<br>增加前导码，从而便于在繁杂的波形中，一眼识别出需要特定的波形</p>
<p>同时，如果测量的时间值非常小，那么用示波器即便可以识别，但不容易捕获</p>
<h2 id="SWD解决方案">SWD解决方案</h2><p>在ARM Cortex-M 芯片中，用SWD调试接口取代了传统的JTAG调试接口，从而占用MCU更少的管脚，同时提高了调试性能。</p>
<p>SWD由四根线组成，SWO，SWDIO，SWCLK，GND；SWDIO和SWCLK组成了基本的串行调试接口，SWO则提供一个信息输出通道，<br>可以输出很多信息，比如指令的执行时间或者ISR触发事件，所以我们可以通过SWD接口配合IDE来获取代码执行时间，从而在某种程度上取代示波器</p>
        
          <p class="article-more-link">
            <a href="/2014/10/16/use-swd-interface-to-measure-time/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/16/use-swd-interface-to-measure-time/" data-id="cifetjxz2004oo5xnm7kpiy58" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-preinc-and-postinc-problem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/16/preinc-and-postinc-problem/" class="article-date">
  <time datetime="2014-10-16T09:27:18.000Z" itemprop="datePublished">Oct 16 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/C-语言/">C 语言</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/16/preinc-and-postinc-problem/">C语言获取循环数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在很多时候，我们需要循环序列，比如循环读取数组的8个元素，便需要索引指针(index)从0-7-0变化，<br>常规而言，会写出下面的代码</p>
<figure class="highlight c"><figcaption><span>if 语句</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (++index &gt;= <span class="number">8</span>)</span><br><span class="line">&#123;</span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight c"><figcaption><span>？表达式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = (++index &gt;= <span class="number">8</span>)? <span class="number">0</span>:index;</span><br></pre></td></tr></table></figure>
<p>观察到这是连续循环操作，所以我们可以用<code>%</code>的方式，来省掉一个判断语句，如下所示</p>
<figure class="highlight c"><figcaption><span>取余语句</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = (++index)%<span class="number">8</span>;</span><br></pre></td></tr></table></figure>
<p>因为<code>++</code>优先级高于<code>%</code>，所以进而简化为<br><figure class="highlight c"><figcaption><span>正确写法</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = ++index%<span class="number">8</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>特别注意：</strong> 这里是前置递加操作，不要写成后置，如下所示<br><figure class="highlight c"><figcaption><span>错误写法</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = index++%<span class="number">8</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果写成后置的，会出现什么情况呢？</p>
<p>分别将二者反汇编（ARM反汇编），如下所示</p>
<figure class="highlight c"><figcaption><span>错误写法 index = index++%8</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MOVS      R1, <span class="preprocessor">#<span class="number">8</span></span></span><br><span class="line">MOVS      R0, R4</span><br><span class="line">UDIV      R4, R0, R1</span><br><span class="line">MLS       R4, R4, R1, R0</span><br><span class="line">ADDS      R4, R4, <span class="preprocessor">#<span class="number">1</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><figcaption><span>正确写法 index = ++index%8</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ADDS      R4, R4, <span class="preprocessor">#<span class="number">1</span></span></span><br><span class="line">MOVS      R0, <span class="preprocessor">#<span class="number">8</span></span></span><br><span class="line">UDIV      R1, R4, R0</span><br><span class="line">MLS       R1, R1, R0, R4</span><br><span class="line">MOVS      R4, R1</span><br></pre></td></tr></table></figure>
<p>翻译成C语言如下</p>
<figure class="highlight c"><figcaption><span>错误</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index = index%<span class="number">8</span>;</span><br><span class="line">index = index + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><figcaption><span>正确</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index = index + <span class="number">1</span>;</span><br><span class="line">index = index%<span class="number">8</span>;</span><br></pre></td></tr></table></figure>
<p>编译器不支持取余运算，所以需要数学计算，取余等于</p>
<pre><code><span class="keyword">A</span>%B = <span class="keyword">A</span> - (<span class="keyword">A</span>/B）*B
</code></pre><p>对此，不做过多解释，重点关注ADD那句的位置，正确的表达式会先计算index的值，然后再取余；<br>而错误的，则先取余，再递增；</p>
<p>所以，正确的语句<code>index = ++index%8</code>会输出<code>0 - 1 - 2 ... 7 - 0</code>序列，错误的会输出<code>1 - 2 ... 7 - 8 - 1</code>序列</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/16/preinc-and-postinc-problem/" data-id="cifetjxz9004ro5xnnp803ltb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-knowledge-about-oscilloscope-probe" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/11/knowledge-about-oscilloscope-probe/" class="article-date">
  <time datetime="2014-10-11T14:11:19.000Z" itemprop="datePublished">Oct 11 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/示波器/">示波器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/11/knowledge-about-oscilloscope-probe/">示波器探头知识--衰减率</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天在使用示波器XY通道的时候，发现两个信道不同步，衰减比例不一样，导致信号误差</p>
<p>特此写个博客记录1X/10X衰减率的应用场合，以免下次误用</p>
<ul>
<li><p>1X<br>信号未经衰减直接经过探头传输至示波器，其耐压能力不及其它无源探头，但它具备测试小信号的优势。由于不像10：1衰减比探头那样信号需要示波器再放大10倍显示，所以示波器内部噪声未放大，测量噪声更小，此类更适用于测试小信号或电源纹波噪声</p>
</li>
<li><p>10X<br>具备高阻抗10MΩ，因此它对待测电路的负载效应很小，能覆盖一般低频频段（500MHz以内），耐压能力强（300V-400Vrms），价格便宜，通用性好，所以得到广泛使用</p>
</li>
</ul>
<p>更高衰减率的探头归类为<strong>无源高压探头</strong>， 适合测量高压，超高压电信号</p>
<h3 id="参考资料">参考资料</h3><ul>
<li><a href="!--￼0--&gt;/assets/2014/10/11/Oscilloscope_Art.pdf">示波器的艺术</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/11/knowledge-about-oscilloscope-probe/" data-id="cifetjxzd004wo5xnu3xdhmei" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mcu-software-framework" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/10/mcu-software-framework/" class="article-date">
  <time datetime="2014-10-10T13:35:15.000Z" itemprop="datePublished">Oct 10 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/杂谈/">杂谈</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/10/mcu-software-framework/">嵌入式软件裸机框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>嵌入式平台和PC平台的很大区别是定制化，可以不用操作系统来执行代码，这就带来了一个问题：软件中，需要延时时，死等会让MCU空转，其它任务无法执行，因此，很多人着手解决这个问题。</p>
<p>大致的思路是：将长时间延时分解为小段，然后设置标志位和记录状态，不断查询，在需要延时等待的时候，主动放弃MCU；让其它任务得以执行；不同模块间用消息来传递<br><strong>专业术语叫做：状态机+消息分发</strong></p>
<p>这是一个引子，后面会详细来写文章分析各类框架的利弊，以助大家在实际项目中，合理使用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/10/mcu-software-framework/" data-id="cifetjxzf004zo5xnebfkto9m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-push-blog-source-to-github" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/09/push-blog-source-to-github/" class="article-date">
  <time datetime="2014-10-09T15:17:25.000Z" itemprop="datePublished">Oct 9 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/github/">github</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/09/push-blog-source-to-github/">定时备份Blog源文件到github</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言">前言</h2><p>hexo框架是一款非常好用的blog生成工具，可以方便的将markdown转换成HTML网页，并传到github.io网站。<br>但是hexo在push的时候，只会推送public目录下的文件到远程master分支，而不会保存源文件和网站主题，<br>这样会导致风险，万一哪天我们的markdown文件挂掉，就仅仅剩github的网页文件了，所以定时将源文件备份到github是个好习惯</p>
<h3 id="1：创建本地仓库">1：创建本地仓库</h3><p><code>cd</code>进blog所在目录，输入下面命令将文件纳入git管理系统</p>
<pre><code>git init
git add .
git <span class="operator"><span class="keyword">commit</span> -<span class="keyword">m</span> <span class="string">"first commit"</span>    </span>
</code></pre><h3 id="2:_删除远程source分支">2: 删除远程source分支</h3><p>如果您是从octopress转过来的，那远程仓库中，默认会存在一个source分支；而hexo不会自动push到source，所以<br>这个分支是很久以前的文件，这里我们将删掉</p>
<pre><code>git <span class="keyword">push</span> &lt;远程仓库地址&gt; :<span class="keyword">source</span>
</code></pre><p>比如我的地址是<code>https://github.com/cedar-renjun/cedar-renjun.github.io.git</code>，则上述命令是</p>
<pre><code>git push <span class="symbol">https:</span>/<span class="regexp">/github.com/cedar</span>-renjun/cedar-renjun.github.io.git <span class="symbol">:source</span>
</code></pre><p><strong>注意</strong> <code>:</code>之前有一个空格</p>
<p>上面的命令太长了，不好输入，我们可以用<code>remote</code>来简化输入</p>
<pre><code>git remote <span class="built_in">add</span> blog http<span class="variable">s:</span>//github.<span class="keyword">com</span>/cedar-renjun/cedar-renjun.github.io.git
</code></pre><p>这样，blog就是远程的仓库地址，我们可以用下面命令来检测是否生效</p>
<pre><code><span class="title">git</span> remote -v
</code></pre><h3 id="3：创建本地分支">3：创建本地分支</h3><pre><code><span class="label">git</span> <span class="keyword">branch </span>-<span class="keyword">b </span>source
</code></pre><p>这个命令，创建了一个souce分支，并切换到source分支了</p>
<h3 id="4：推送到远程分支">4：推送到远程分支</h3><pre><code>git <span class="keyword">push</span> blog <span class="keyword">source</span>:<span class="keyword">source</span>
</code></pre><p>前一个<code>source</code>表示本地分支名字，后一个表示远程仓库名字，名字可以变，但位置不能变</p>
<p>至此，我们已经将source文件推送到远程分支，可以高枕无忧了 ^_^</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/09/push-blog-source-to-github/" data-id="cifetjxzi0052o5xnhrg40ya8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mbed-iot-device-platform" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/09/mbed-iot-device-platform/" class="article-date">
  <time datetime="2014-10-09T14:23:27.000Z" itemprop="datePublished">Oct 9 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Mbed/">Mbed</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/09/mbed-iot-device-platform/">Mbed IoT Device Platform</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong><br>Mark：ARM推出了Mbed平台，试图统一IOT平台，原来看过Mbed的源码，写的很赞，用C++做封装，事件调度机制，非常适合小型系统，最近又看到它们支持各种协议栈，和Thread一样，借助大企业平台的优势，Mbed以后会发展的很好，特此转发ARM文章
</strong></p>
<p><br/></p>
<p><img src="!--￼0--&gt;/images/2014/10/09/ARM-mbed-IoT-platform.png" alt=""></p>
<h2 id="About_Mbed">About Mbed</h2><p>The Internet of Things (IoT) is about devices and services delivering end-to-end solutions. <a href="http://mbed.org/">The ARM® mbed™ IoT Device Platform</a> is the fastest way to create commercial and interoperable connected IoT devices based on ARM microcontrollers. Interoperability between nodes and cloud services across market segments will unleash the full potential of the IoT. Although the IoT market is made up of many vertical segments, most applications that can make use of Internet connected devices have a common foundation. For example - smart cities, basic wearables and smart home devices require basic OS functionality like drivers, device security and provisioning support. In addition, network connectivity varies from application to application, in general however, the IP networking, security, application layer and device management needs are all common.</p>
<p>The ARM mbed IoT Device Platform provides all the key ingredients to build secure and efficient IoT applications through ARM’s mbed OS, mbed Device Server and mbed Community Ecosystem.</p>
        
          <p class="article-more-link">
            <a href="/2014/10/09/mbed-iot-device-platform/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/10/09/mbed-iot-device-platform/" data-id="cifetjxzl0054o5xnv71nvxk5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-analysis-of-zigbee-led-module" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/23/analysis-of-zigbee-led-module/" class="article-date">
  <time datetime="2014-09-23T10:23:26.000Z" itemprop="datePublished">Sep 23 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/教程/">教程</a>►<a class="article-category-link" href="/categories/教程/Zigbee/">Zigbee</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/23/analysis-of-zigbee-led-module/">Z-Stack协议栈分析-LED模块</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言">前言</h2><p>TI的Zigbee协议（Z-Stack）是典型的事件驱动系统，整个系统分为多个任务，各自任务内部采用状态机非阻塞似的完成任务，<br>完成后，主动释放MCU控制权；下层的任务或异步事件产生的事件，将其封装成事件消息+数据，然后发送到事件处理函数，<br>在事件处理函数中，也是采用状态机的形式分发消息并处理。</p>
<p>这就是所谓的协作式调度器，它的好处，是避免了传统RTOS的重型线程调度和资源保护机制，从而可以做到无锁资源保护机制<br>和极度轻量化，节省RAM/ROM</p>
<p>关于这点，后面会详细的讨论，这里重点讨论HAL层的LED机制</p>
<p><strong>注：对于HAL层的实现机制，会另有专门的文章来讨论这个话题</strong></p>
        
          <p class="article-more-link">
            <a href="/2014/09/23/analysis-of-zigbee-led-module/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/09/23/analysis-of-zigbee-led-module/" data-id="cifetjxzn0057o5xnfc7shufi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-good-blog-about-coroutines" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/21/good-blog-about-coroutines/" class="article-date">
  <time datetime="2014-09-21T09:07:39.000Z" itemprop="datePublished">Sep 21 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/转载/">转载</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/21/good-blog-about-coroutines/">谈谈协程和C语言的协程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>注：</strong> 本文转自 <a href="http://www.yeolar.com/note/2013/02/17/coroutines/">http://www.yeolar.com/note/2013/02/17/coroutines/</a></p>
<p>晚上在整理我的 $HOME 的时候，发现了一段有趣的代码，它被保存为了a.c并存在了差不多半年之久。种种迹象表明，它很重要。其实我记得它，当初在网上看到，觉得它包含了一个巧妙的技巧，就让它长住在我的硬盘上了，今天我决定把它搬到这篇文章中。好吧，我是打算谈一谈协程的概念。</p>
<h2 id="一个例子">一个例子</h2><p>先给大家看一下这段代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">int</span> state;</span><br><span class="line">&#125; task;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> crBegin(state) \</span><br><span class="line">        switch (state) &#123; case <span class="number">0</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> crReturn(state, ret) \</span><br><span class="line">        (state) = __LINE__; return (ret); case __LINE__:</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> crEnd() \</span><br><span class="line">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cb</span><span class="params">(task *t)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    crBegin(t-&gt;state);</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        t-&gt;num = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (t-&gt;i = <span class="number">0</span>; t-&gt;i &lt; <span class="number">20</span>; t-&gt;i++) &#123;</span><br><span class="line">            crReturn(t-&gt;state, t-&gt;num);</span><br><span class="line">            t-&gt;num += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    crEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    task t;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    t.state = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, cb(&amp;t));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/2014/09/21/good-blog-about-coroutines/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/09/21/good-blog-about-coroutines/" data-id="cifetjxzp005bo5xntt24koer" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-state-machine-timer-resource-management" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/17/state-machine-timer-resource-management/" class="article-date">
  <time datetime="2014-09-17T07:00:29.000Z" itemprop="datePublished">Sep 17 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/教程/">教程</a>►<a class="article-category-link" href="/categories/教程/框架/">框架</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/17/state-machine-timer-resource-management/">在状态机中管理时间资源</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面的话">写在前面的话</h2><p>在嵌入式系统中，经常会使用到延时(Delay)函数，延时有长，有短；500us以下的延时，可以完全用软件来做；较长的延时，可以用硬件Timer或者调用RTOS的时间管理函数。</p>
<p>在简单的MCU中，由于资源限制，无法使用常规的RTOS，这时就需要自己写相应的协调式调度算法，常见的有协程和时间片轮询机制等，万变不离其宗，它们其中的核心是状态机，在状态机中一个核心原则是：<strong>函数不能长时间阻塞MCU</strong>，否则就会导致整个系统调度失效。也就是说：<strong>无法使用纯软件延时</strong></p>
<p>例如，在系统中严禁出现下面代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay_s</span><span class="params">(uint8_t tick_s)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Code Snippet 1</span></span><br><span class="line"></span><br><span class="line">delay_s(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Code Snippet 2</span></span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/2014/09/17/state-machine-timer-resource-management/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/09/17/state-machine-timer-resource-management/" data-id="cifetjxzr005eo5xn12vgr4uc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-missing-you" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/01/missing-you/" class="article-date">
  <time datetime="2014-09-01T14:33:39.000Z" itemprop="datePublished">Sep 1 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/杂谈/">杂谈</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/01/missing-you/">那些人，珍重便好</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote><p>“人生有时候，总是很讽刺。一转身可能就是一世。说好永远的，不知怎么就散了。最后自己想来想去竟然也搞不清当初是什么原因分开彼此的。然后，你忽然醒悟，感情原来是这么脆弱的。经得起风雨，却经不起平凡；风雨同船，天晴便各自散了。也许只是赌气，也许只是因为小小的事。幻想着和好的甜蜜，或重逢时的拥抱，那个时候会是边流泪边捶打对方，还傻笑着。该是多美的画面。没想到的是，一别竟是一辈子了。”</p>
<footer><strong>张爱玲 《有些人我们一直在错过》</strong></footer></blockquote>
<pre><code>有些人，渐行渐远
有些人，来去如风
有些人，或许不会再见
有些人，珍重便好
</code></pre><p>某年回家，在车上偶遇多年未见的同学，一路上聊起来，我问他是怎么认出我来的，他说：“这些年你都没有怎么变”，我笑笑说：“还是跟以前一样傻逼吧”，他也笑笑。他说：“你现在在哪工作”，“武汉读书”，忽然他就提高了音调，“还在读书呀，读大学吧，你看你都读老了，不要读成书呆子”，接着自顾自地说了一堆，“我们打工的那个厂里面一堆大学生，你看现在，什么都缺，就是不缺大学生，读书有什么用，你读出来还不是跟我一样去打工……”听着他唠叨了一大堆，我就只有颔首而笑的份，我明白，我只有用笑容来表示我对他的尊重。下车前，我们互留了电话号码，告别以留下“常联系”这句话后的背影作为结束。号码也只是藏在电话本里的某个角落，只有在过年的时候才会互道一声问候，虽然想打电话联系，但是不知道说什么好，怕尴尬，怕那种只能挤出牙缝的陌生，索性在某次清理通讯录的时候，我把他从我的通讯录里删除了。</p>
<p>这让我想起了我一位高中同学，很长一段时间，我和他坐同桌。他平时就是打篮球，上网和睡觉，篮球打得很棒，各方面也不错，但是有一点，就是不喜欢学习，考试都是比较糟糕。曾想过帮他，但是后来发现这是一件很难的事情，人各有志，命里无时莫强求，也许学习这条路对于每个人并不是都是合适的，每个人都有适合自己的事做，最后高考考完他就消失了，填志愿的时候他也没来，还没来得及道别，后来QQ上也没见他上过线。常言道“天下没有不散的宴席”，但有时却是，宴席还没有摆上，还没来得及陪君醉笑三千场，不诉离殇，就有人抽身而去，连一个身影都没有留下。后来有一次，辗转了解到毕业后他就回家了，之后喜当爹了，现在孩子应该可以打酱油了吧，也不知道他现在在做什么，希望应该比学习有趣吧。</p>
<p>打开邮箱，看到同学发来的这样一份邮件，“毕业的，没毕业的，上班的，没上班的，我们都开始忙碌了；好像越来越少有时间，去问候和想念；会不会有天，我们真的都忘记了彼此，遗忘了那些最美丽的回忆？我们曾在某个时间相遇，曾在某个时段某个时候，在一起。然后，因为这样那样的原因，我们不常联系。只是想轻轻地告诉你：我很好，希望你也很好。”看到这个心里觉得矫情，但我们终究会明白，每个人总会走上自己选择的路，不管怎样，还是希望听到他们的好消息。</p>
<p>在一个地方待得太久，就会渐渐的忘记时间，曾经以为这样的日子会长久，但终究在这样一个宁静的午后戛然而止。我们各自背上行囊，或许道一声珍重，或许相顾无言，各自奔走天涯。多年以后，你是否会记得那个喧嚣或者沉默的下午，那个远去的背影消失在遥远的尽头，那趟踏上远方的列车，我们各自转身，不再回头。可叹人世多错过，两人彼此遍寻不着，只存一份念想；淡淡的眷恋潜浮于眸，深深的情愫隐藏于心，在时间里慢慢发酵，酝酿出那一番醇香。王家卫导演在解释《一代宗师》张震的戏份太少时曾说过，有时候生命中遇见一些人，但之后就再也没见到过了，这是一部分的人生。</p>
<p>我们从久远走来，相濡以沫或者相忘于江湖，江南说：江湖是这么一个地方，你在这里生，也不介意在这里死去。可你想过没有，多年以后，或许江湖还是那个江湖，你已不是当年的那个你，曾经的那些美好都成为了过往，就算时光真的可以倒流，你会发现，一切早已经面目全非。所有的相遇，都是久别重逢，那么所有的重逢，都是时光之约，里面装满了风尘与岁月。</p>
<p>最后，这些东西都慢慢的幻化成回忆，这个世界有太多我们无能为力的东西，回不到的过去，无法预知的未来，以及那些那些再也没有见到过的人……</p>
<p>如果哪天那些人和你从此不会再见了，不是有一些新的人取而代之了，新的阶段出现了，就是遥远的我们都“懒”了。</p>
<p>曲终人会散，人走茶会凉，最后，收拾心情，背上行囊，继续上路。</p>
<p>文/阿飞 <a href="http://www.douban.com/note/295698799/" target="_blank" rel="external">http://www.douban.com/note/295698799/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cedar-renjun.github.io/2014/09/01/missing-you/" data-id="cifetjxzt005io5xn7706g4cd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C-语言/">C 语言</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IAR/">IAR</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jlink/">Jlink</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Jlink/gcc/">gcc</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mbed/">Mbed</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/QT/">QT</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SWD/">SWD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc/">gcc</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github/">github</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/github/octopress/">octopress</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/scons/">scons</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/思维训练/">思维训练</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/教程/Doxygen/">Doxygen</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/IAR/">IAR</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/SublimeText/">SublimeText</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/Zigbee/">Zigbee</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/框架/">框架</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/开源/">开源</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/树莓派/">树莓派</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/示波器/">示波器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/转载/励志/">励志</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/方法论/">方法论</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/管理/">管理</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Cedar<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/plan" class="mobile-nav-link">Plan</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>